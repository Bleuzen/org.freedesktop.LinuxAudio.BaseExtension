{
    "id" : "org.freedesktop.LinuxAudio.BaseApp",
    "branch": "20.04",
    "runtime" : "org.kde.Platform",
    "sdk" : "org.kde.Sdk",
    "runtime-version" : "5.14",
    "finish-args": [
        /* On SuSE it seems to be necessary for sound to work */
        "--env=ALSA_CONFIG_PATH=",
        /* extensions LV2 */
        "--env=LV2_PATH=/app/extensions/lv2",
        "--env=DSSI_PATH=/app/extensions/dssi",
        "--env=LADSPA_PATH=/app/extensions/ladspa"
    ],
    "add-extensions": {
        "org.freedesktop.LinuxAudio.Lv2Plugin": {
            "directory": "extensions",
            "add-ld-path": "lib",
            "merge-dirs": "lv2",
            "subdirectories": true,
            "no-autodownload": true,
            "autodelete": true
        },
        "org.freedesktop.LinuxAudio.DssiPlugin": {
            "directory": "extensions",
            "add-ld-path": "lib",
            "merge-dirs": "dssi",
            "subdirectories": true,
            "no-autodownload": true,
            "autodelete": true
        },
        "org.freedesktop.LinuxAudio.LadspaPlugin": {
            "directory": "extensions",
            "add-ld-path": "lib",
            "merge-dirs": "ladspa",
            "subdirectories": true,
            "no-autodownload": true,
            "autodelete": true
        }
    },
    "modules" : [
        "gtkmm2.json",
        {
            "name": "jack2",
            "buildsystem": "simple",
            "build-commands": [
                "./waf configure --prefix=/app --htmldir=/app/share/doc/jack/ --classic",
                "./waf build -j $FLATPAK_BUILDER_N_JOBS",
                "./waf install"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/jackaudio/jack2/releases/download/v1.9.14/v1.9.14.tar.gz",
                    "sha256": "a20a32366780c0061fd58fbb5f09e514ea9b7ce6e53b080a44b11a558a83217c"
                }
            ]
        },
        {
          "name": "liblo",
          "sources": [
            {
              "type": "archive",
              "url": "http://download.sf.net/sourceforge/liblo/liblo-0.31.tar.gz",
              "sha256": "2b4f446e1220dcd624ecd8405248b08b7601e9a0d87a0b94730c2907dbccc750"
            }
          ]
        },
        {
            "name": "lv2",
            "buildsystem": "simple",
            "build-commands": [
                "python3 ./waf configure --prefix=/app --lv2dir=/app/lib/lv2 --copy-headers",
                "python3 ./waf build -j $FLATPAK_BUILDER_N_JOBS",
                "python3 ./waf install"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "http://lv2plug.in/spec/lv2-1.16.0.tar.bz2",
                    "sha256": "dec3727d7bd34a413a344a820678848e7f657b5c6019a0571c61df76d7bdf1de"
                }
            ],
            "post-install": [
                "install -Dm644 -t /app/share/licenses/lv2 COPYING",
                "ln -sf /app/lib/pkgconfig/lv2.pc /app/lib/pkgconfig/lv2core.pc"
            ]
        },
        {
          "name": "dssi",
          "rm-configure": true,
          "config-opts": [
            "--disable-static"
          ],
          "sources": [
            {
              "type": "archive",
              "url": "http://download.sf.net/sourceforge/dssi/dssi-1.1.1.tar.gz",
              "sha256": "f2c82b073a947c8255284249097667f9b14e660bf86186f3fcd3b3b3e087814e"
            },
            {
              "type": "script",
              "commands": [
                "autoreconf -fiv"
              ],
              "dest-filename": "autogen.sh"
            }
          ]
        },
        {
            "name": "lash",
            "rm-configure": true,
            "config-opts": [
                "--disable-static",
                "--disable-serv-inst",
                "CFLAGS=-D_GNU_SOURCE"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://download.savannah.gnu.org/releases/lash/lash-0.5.4.tar.gz",
                    "sha256": "105a7da84415c4725c6bcad28e70f23aeb4534f94fc80ca262b6a2cef2226c16"
                },
                {
                    "type": "patch",
                    "strip-components": 0,
                    "path": "patches/lash-0.5.3-no-static-lib.patch"
                },
                {
                    "type": "patch",
                    "path": "patches/lash-gcc47.patch"
                },
                {
                    "type": "patch",
                    "path": "patches/lash-linking.patch"
                },
                {
                    "type": "patch",
                    "strip-components": 0,
                    "path": "patches/lash-configure.patch"
                },
                {
                    "type": "script",
                    "commands": [
                        "autoreconf -fiv"
                    ],
                    "dest-filename": "autogen.sh"
                }
            ]
        },
        {
            "name": "libinstpatch",
            "buildsystem": "cmake-ninja",
            "config-opts": [
                "-DLIB_SUFFIX="
            ],
            "cleanup": [
		"/share/doc"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/swami/libinstpatch/archive/v1.1.4.tar.gz",
                    "sha256": "e529b15055b7341ab7a75885338d0a9b84859e3f6ca3ed3c363e7f3521329c9c"
                }
            ]
        },
        {
            "name": "fluidsynth",
            "buildsystem": "cmake-ninja",
            "config-opts": [
                "-DLIB_SUFFIX="
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/FluidSynth/fluidsynth/archive/v2.1.2.tar.gz",
                    "sha256": "9206d83b8d2f7e1ec259ee01e943071de67e419aabe142b51312f8edb39c5503"
                }
            ]
        },
        {
          "name": "lrdf",
          "rm-configure": true,
          "modules": [
            {
              "name": "ladspa",
              "no-autogen": true,
              "subdir": "src",
              "make-install-args": [
                "INSTALL_PLUGINS_DIR=/app/lib/ladspa",
                "INSTALL_INCLUDE_DIR=/app/include",
                "INSTALL_BINARY_DIR=/app/bin"
              ],
              "sources": [
                {
                  "type": "archive",
                  "url": "http://www.ladspa.org/download/ladspa_sdk_1.15.tgz",
                  "sha256": "4229959b09d20c88c8c86f4aa76427843011705df22d9c28b38359fd1829fded"
                }
              ]
            },
            {
              "name": "libxml2",
              "config-opts": [
                "--without-python",
                "--disable-static"
              ],
              "sources": [
                {
                  "type": "archive",
                  "url": "https://github.com/GNOME/libxml2/archive/v2.9.8.tar.gz",
                  "sha256": "ff879b0d9142564bfe63df9753df936f05150afdd7bae07261f12d4dad33ba4a"
                }
              ]
            },
            {
              "name": "raptor2",
              "config-opts": [
                "--disable-static"
              ],
              "sources": [
                {
                  "type": "archive",
                  "url": "http://download.librdf.org/source/raptor2-2.0.15.tar.gz",
                  "sha256": "ada7f0ba54787b33485d090d3d2680533520cd4426d2f7fb4782dd4a6a1480ed"
                }
              ]
            }
          ],
          "sources": [
            {
              "type": "archive",
              "url": "https://github.com/swh/LRDF/tarball/0.5.0",
              "dest-filename": "swh-LRDF-0.5.0-0-g7ebc032.tar.gz",
              "sha256": "013002b91ef209827fe99552b8c7f0b569cddb3d6f1439bedbd8bafe1956a93c"
            },
            {
              "type": "script",
              "commands": [
                "autoreconf -fiv"
              ],
              "dest-filename": "autogen.sh"
            }
          ]
        },
        {
            "name": "polish",
            "buildsystem": "simple",
            "build-commands": [
                "mkdir -p ${DESTDIR}/app/share/appdata",
                "install org.freedesktop.LinuxAudio.BaseApp.appdata.xml ${DESTDIR}/app/share/appdata"
            ],
            "post-install": [
                "install -d /app/extensions"
            ],
            "sources": [
                {
                    "type": "file",
                    "path": "org.freedesktop.LinuxAudio.BaseApp.appdata.xml"
                }
            ]
        }
    ]
}


